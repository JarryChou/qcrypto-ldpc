<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>qCrypto: errorcorrection/priv_amp.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">qCrypto
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A collection of code for a practical entanglement-based quantum key distribution system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('priv__amp_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">priv_amp.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="priv__amp_8h_source.html">priv_amp.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for priv_amp.c:</div>
<div class="dyncontent">
<div class="center"><img src="priv__amp_8c__incl.png" border="0" usemap="#aerrorcorrection_2priv__amp_8c" alt=""/></div>
<map name="errorcorrection_2priv__amp_8c" id="aerrorcorrection_2priv__amp_8c">
<area shape="rect" title=" " alt="" coords="259,5,390,47"/>
<area shape="rect" href="priv__amp_8h.html" title=" " alt="" coords="281,95,368,121"/>
<area shape="rect" href="defaultdefinitions_8h.html" title=" " alt="" coords="109,333,239,360"/>
<area shape="rect" href="globalvars_8h.html" title="Definition file for global variables in ecd2." alt="" coords="83,251,175,278"/>
<area shape="rect" href="packets_8h.html" title=" " alt="" coords="5,333,84,360"/>
<area shape="rect" href="keyblock_8h.html" title="Header file containing the definitions of the keyblock &amp; block related data for the error correction ..." alt="" coords="690,333,775,360"/>
<area shape="rect" href="pkt__header__7_8h.html" title=" " alt="" coords="878,244,1019,285"/>
<area shape="rect" href="comms_8h.html" title=" " alt="" coords="211,169,287,196"/>
<area shape="rect" href="helpers_8h.html" title=" " alt="" coords="779,251,854,278"/>
<area shape="rect" href="debug_8h.html" title=" " alt="" coords="251,251,319,278"/>
<area shape="rect" href="thread__mgmt_8h.html" title=" " alt="" coords="526,169,635,196"/>
<area shape="rect" href="proc__state_8h.html" title=" " alt="" coords="343,251,437,278"/>
<area shape="rect" href="rnd_8h.html" title=" " alt="" coords="799,333,850,360"/>
<area shape="rect" href="pkt__header__3_8h.html" title=" " alt="" coords="462,244,603,285"/>
</map>
</div>
</div>
<p><a href="priv__amp_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:afa0aab17f062b64973ef26554d46c306"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="priv__amp_8c.html#afa0aab17f062b64973ef26554d46c306">initiate_privacyamplification</a> (struct <a class="el" href="structkeyblock.html">keyblock</a> *kb)</td></tr>
<tr class="memdesc:afa0aab17f062b64973ef26554d46c306"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="priv__amp_8h.html">priv_amp.h</a> <br  />
 Part of the quantum key distribution software for error correction and privacy amplification.  <a href="priv__amp_8c.html#afa0aab17f062b64973ef26554d46c306">More...</a><br /></td></tr>
<tr class="separator:afa0aab17f062b64973ef26554d46c306"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af014f9642f652afb57efba0d1eddd37b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="priv__amp_8c.html#af014f9642f652afb57efba0d1eddd37b">receive_privamp_msg</a> (char *receivebuf)</td></tr>
<tr class="separator:af014f9642f652afb57efba0d1eddd37b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad859394d26f4d4609bee37a5a18cb135"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="priv__amp_8c.html#ad859394d26f4d4609bee37a5a18cb135">do_privacy_amplification</a> (struct <a class="el" href="structkeyblock.html">keyblock</a> *kb, unsigned int seed, int lostbits)</td></tr>
<tr class="separator:ad859394d26f4d4609bee37a5a18cb135"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad859394d26f4d4609bee37a5a18cb135"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad859394d26f4d4609bee37a5a18cb135">&#9670;&nbsp;</a></span>do_privacy_amplification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int do_privacy_amplification </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkeyblock.html">keyblock</a> *&#160;</td>
          <td class="paramname"><em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>seed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lostbits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="priv__amp_8c_source.html#l00065">65</a> of file <a class="el" href="priv__amp_8c_source.html">priv_amp.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                           {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">int</span> sneakloss;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordtype">float</span> trueerror, safe_error;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">// float cheeky_error;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *finalkey;  <span class="comment">/* pointer to final key */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m;          <span class="comment">/* addition register */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordtype">int</span> numwords, mlen;      <span class="comment">/* number of words in final key / message length */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keyword">struct </span><a class="code" href="structheader__7.html">header_7</a> *outmsg; <span class="comment">/* keeps output message */</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>, j;                <span class="comment">/* counting indices */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">char</span> <a class="code" href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a>[<a class="code" href="defaultdefinitions_8h.html#ade60ede0376eec193b38f3f28cb62c5e">FNAMELENGTH</a> + 10]; <span class="comment">/* to store filename */</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="keywordtype">int</span> written, rv;              <span class="comment">/* counts writeout bits, return value */</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">int</span> redundantloss; <span class="comment">/* keeps track of redundancy in error correction */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordtype">float</span> BellHelper;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">/* determine final key size */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">/* redundancy in parity negotiation; we transmit the last bit which could#</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">     be deducked from tracking the whole parity information per block. For</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">     each detected error, there is one bit redundant, which is overcounted</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">     in the leakage */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  redundantloss = kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">/* This is the error rate found in the error correction process. It should</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">     be a fair representation of the errors on that block of raw key bits,</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">     but a safety margin on the error of the error should be added, e.g.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">     in terms of multiples of the standard deviation assuming a poissonian</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">     distribution for errors to happen (not sure why this is a careless</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">     assumption in the first place either. */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  trueerror = (float)kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a> / (<span class="keywordtype">float</span>)kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">/* This &#39;intrisic error&#39; thing is very dodgy, it should not be used at all</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">     unless you know what Eve is doing (which by definition you don&#39;t).</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">     Therefore, it s functionality is mostly commented out, only the</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">     basic query remains. The idea is based on the hope ventilated</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">     at some point that there is a basic error (of the kind of a detector</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">     dark count rate) which does lead to any information</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">     loss to the eavesdropper. Relies on lack of imagination how an</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">     eavesdropper can influence this basic error rather than on fundamental</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">     laws. Since this is dirty, we might as well assume that such an error</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">     is UNCORRELATED to errors caused by potential eavesdropping, and</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">     assume they add quadratically. Let&#39;s at least check that the true</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">     error is not smaller than the &quot;basic&quot; error..... */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ecd2_8h.html#a9705b16acc86a3fcb33a75cd1eb0c43c">intrinsicerr</a> &lt; trueerror) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// Unused code</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// cheeky_error = sqrt(trueerror * trueerror - intrinsicerr * intrinsicerr);</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">/* Dodgy intrinsic error subtraction would happen here. */</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">/* We now evaluate the knowledge of an eavesdropper on the initial raw</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">       key for a given error rate, excluding the communication on error</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">       correction */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="ecd2_8h.html#a1cf2a769e7368499d8872067d8ceacfd">bellmode</a>) { <span class="comment">/* do single-photon source bound */</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a> &gt; 0) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        safe_error = trueerror * (1. + <a class="code" href="ecd2_8h.html#a9609eae2e0e4f132f31d442a8d3acc7f">errormargin</a> / sqrt(kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a>));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        safe_error = trueerror;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      sneakloss = (int)(<a class="code" href="helpers_8c.html#a6191b118553d1fbe518e4cb9dc10c3cd">binentrop</a>(safe_error) * kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="comment">/* old version of the loss to eve:</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">         sneakloss =</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">        (int)(phi(2*sqrt(trueerror*(1-trueerror)))/2.*kb-&gt;workbits);</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">/* we do the device-indepenent estimation */</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      BellHelper = kb-&gt;<a class="code" href="structkeyblock.html#a50aa283cdce616652b5d3a8b91293fce">BellValue</a> * kb-&gt;<a class="code" href="structkeyblock.html#a50aa283cdce616652b5d3a8b91293fce">BellValue</a> / 4. - 1.;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordflow">if</span> (BellHelper &lt; 0.) { <span class="comment">/* we have no key...*/</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        sneakloss = kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      } <span class="keywordflow">else</span> { <span class="comment">/* there is hope... */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        sneakloss =</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            (int)(kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a> * <a class="code" href="helpers_8c.html#a6191b118553d1fbe518e4cb9dc10c3cd">binentrop</a>((1. + sqrt(BellHelper)) / 2.));</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    sneakloss = 0; <span class="comment">/* Wruaghhh - how dirty... */</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="comment">/* here we do the accounting of gained and lost bits */</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a> =</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a> - (kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a> + sneakloss) + redundantloss;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a> &lt; 0) kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a> = 0; <span class="comment">/* no hope. */</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">/* dirtwork for testing. I need to leave this in because it is the basis</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">   for may of the plots we have. */</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  printf(<span class="stringliteral">&quot;PA disable: %d\n&quot;</span>, <a class="code" href="ecd2_8h.html#a3dcabd5a7b4998184c8e155bfefc35df">disable_privacyamplification</a>);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ecd2_8h.html#a3dcabd5a7b4998184c8e155bfefc35df">disable_privacyamplification</a>) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a> = kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a>;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  printf(<span class="stringliteral">&quot;before privacy amp:\n corrected errors: %d\n workbits: %d\n&quot;</span>,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a>, kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  printf(<span class="stringliteral">&quot; trueerror: %f\n sneakloss: %d\n leakagebits: %d\n&quot;</span>, trueerror,</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         sneakloss, kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a> - redundantloss);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  printf(<span class="stringliteral">&quot; finakeybits: %d\n&quot;</span>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">  #ifdef DEBUG</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  fflush(stdout);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">/* initiate seed */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  kb-&gt;<a class="code" href="structkeyblock.html#acb4d8d5a8ec6dfeaad5352daf4d8b843">RNG_state</a> = seed;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">/* set last bits to zero in workbits.... */</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  numwords = (kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a> + 31) / 32;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a> &amp; 31)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    kb-&gt;<a class="code" href="structkeyblock.html#a19b74f671254c24bedb3b167c2b73621">mainbuf</a>[numwords - 1] &amp;= (0xffffffff &lt;&lt; (32 - (kb-&gt;<a class="code" href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">workbits</a> &amp; 31)));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">/* prepare structure for final key */</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  mlen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structheader__7.html">header_7</a>) + ((kb-&gt;finalkeybits + 31) / 32) * 4;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  outmsg = (<span class="keyword">struct </span><a class="code" href="structheader__7.html">header_7</a> *)<a class="code" href="debug_8c.html#af8c2db3d81151416ecd3dcb6f38e3711">malloc2</a>(mlen);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">if</span> (!outmsg) <span class="keywordflow">return</span> 63;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  outmsg-&gt;<a class="code" href="structheader__7.html#a08ea28e2fbeb87380a81fcb3c1bef8f0">tag</a> = <a class="code" href="pkt__header__7_8h.html#a14ea2cca450c06c029139e6f8a77524f">TYPE_7_TAG</a>; <span class="comment">/* final key file */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  outmsg-&gt;<a class="code" href="structheader__7.html#aab7a9200bfffed9a73f057aa631b5b7f">epoc</a> = kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  outmsg-&gt;<a class="code" href="structheader__7.html#ad10670821f2dc976f91dc2daa7bac0c2">numberofepochs</a> = kb-&gt;<a class="code" href="structkeyblock.html#a39ef5181e0b5a80b4487af22f3fc0424">numberofepochs</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  outmsg-&gt;<a class="code" href="structheader__7.html#aca413382a94bc8f2f6cca2841b4c4ea2">numberofbits</a> = kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  finalkey = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)&amp;outmsg[1]; <span class="comment">/* here starts data area */</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">/* clear target buffer */</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  bzero(finalkey, (kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a> + 31) / 32 * 4);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">/* prepare final key */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="ecd2_8h.html#a3dcabd5a7b4998184c8e155bfefc35df">disable_privacyamplification</a>) { <span class="comment">/* no PA fo debugging */</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; numwords; j++) finalkey[j] = kb-&gt;<a class="code" href="structkeyblock.html#a19b74f671254c24bedb3b167c2b73621">mainbuf</a>[j];</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">/* do privacy amplification */</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/* create compression matrix on the fly while preparing key */</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>; <a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { <span class="comment">/* go through all targetbits */</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      m = 0;                                 <span class="comment">/* initial word */</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keywordflow">for</span> (j = 0; j &lt; numwords; j++)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        m ^= (kb-&gt;<a class="code" href="structkeyblock.html#a19b74f671254c24bedb3b167c2b73621">mainbuf</a>[j] &amp; <a class="code" href="rnd_8c.html#a099de46fae1a39893ab79719bf42f2c2">PRNG_value2_32</a>(&amp;kb-&gt;<a class="code" href="structkeyblock.html#acb4d8d5a8ec6dfeaad5352daf4d8b843">RNG_state</a>));</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="rnd_8c.html#abcc0dd5e29de4965c7b9816465f933b7">parity</a>(m)) finalkey[<a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a> / 32] |= <a class="code" href="helpers_8h.html#ae447cbbcd1ebc2fb52c0ef6c0672cffc">bt_mask</a>(<a class="code" href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="comment">/* send final key to file */</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  strncpy(<a class="code" href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a>, <a class="code" href="ecd2_8h.html#a46fec7a15e43bfc6c030840db0536485">fname</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a>], <a class="code" href="defaultdefinitions_8h.html#ade60ede0376eec193b38f3f28cb62c5e">FNAMELENGTH</a>);                <span class="comment">/* fnal key directory */</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="helpers_8c.html#a9e1a87974d8c015ddb41f248076f09e0">atohex</a>(&amp;<a class="code" href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a>[strlen(<a class="code" href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a>)], kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>);        <span class="comment">/* add file name */</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="ecd2_8h.html#ad7c92fd80ab487ec49cee4f015f112ec">handle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a>] = open(<a class="code" href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a>, <a class="code" href="defaultdefinitions_8h.html#abb441a467a8a3c646cca05908e82fd7b">FILEOUTMODE</a>, <a class="code" href="defaultdefinitions_8h.html#a2c11ab874c0a909ae05d17b0f21d9ac8">OUTPERMISSIONS</a>); <span class="comment">/* open target */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">if</span> (-1 == <a class="code" href="ecd2_8h.html#ad7c92fd80ab487ec49cee4f015f112ec">handle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a>]) <span class="keywordflow">return</span> 64;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  written = 0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keywordflow">while</span> (1) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    rv = write(<a class="code" href="ecd2_8h.html#ad7c92fd80ab487ec49cee4f015f112ec">handle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a>], &amp;((<span class="keywordtype">char</span> *)outmsg)[written], mlen - written);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (rv == -1) <span class="keywordflow">return</span> 65; <span class="comment">/* write error happened */</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    written += rv;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (written &gt;= mlen) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    usleep(100000); <span class="comment">/* sleep 100 msec */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  close(<a class="code" href="ecd2_8h.html#ad7c92fd80ab487ec49cee4f015f112ec">handle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a>]);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">/* send notification */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">switch</span> (<a class="code" href="ecd2_8h.html#a1f893df415a3af2c9b549367a95b99b2">verbosity_level</a>) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">case</span> 0: <span class="comment">/* output raw block name */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>], <span class="stringliteral">&quot;%08x\n&quot;</span>, kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">case</span> 1: <span class="comment">/* block name and final bits */</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>], <span class="stringliteral">&quot;%08x %d\n&quot;</span>, kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">case</span> 2: <span class="comment">/* block name, ini bits, final bits, error rate */</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>], <span class="stringliteral">&quot;%08x %d %d %.4f\n&quot;</span>, kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>, kb-&gt;<a class="code" href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">initialbits</a>,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>, trueerror);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">case</span> 3: <span class="comment">/* same as with 2 but with text */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>],</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;              <span class="stringliteral">&quot;startepoch: %08x initial bit number: %d final bit number: %d &quot;</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;              <span class="stringliteral">&quot;error rate: %.4f\n&quot;</span>,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>, kb-&gt;<a class="code" href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">initialbits</a>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>, trueerror);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">case</span> 4: <span class="comment">/* block name, ini bits, final bits, error rate, leak bits */</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>], <span class="stringliteral">&quot;%08x %d %d %.4f %d\n&quot;</span>, kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">initialbits</a>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>, trueerror, kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">case</span> 5: <span class="comment">/* same as with 4 but with text */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      fprintf(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>],</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;              <span class="stringliteral">&quot;startepoch: %08x initial bit number: %d final bit number: %d &quot;</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;              <span class="stringliteral">&quot;error rate: %.4f leaked bits in EC: %d\n&quot;</span>,</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>, kb-&gt;<a class="code" href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">initialbits</a>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>, trueerror,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">  #ifdef DEBUG</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  printf(<span class="stringliteral">&quot;startepoch: %08x initial bit number: %d final bit number: %d error rate: %.4f leaked bits in EC: %d\n&quot;</span>,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;              kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>, kb-&gt;<a class="code" href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">initialbits</a>, kb-&gt;<a class="code" href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">finalkeybits</a>, trueerror, kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  fflush(stdout);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">  #endif</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  fflush(<a class="code" href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a>[<a class="code" href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a>]);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="comment">/* cleanup outmessage buf */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <a class="code" href="debug_8c.html#ae9cba13dc8aa5d62e13112d01be090ba">free2</a>(outmsg);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="comment">/* destroy thread */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  printf(<span class="stringliteral">&quot;remove thread\n&quot;</span>);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  fflush(stdout);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="thread__mgmt_8c.html#a50f74be3f39663e19901c3e1ed240698">remove_thread</a>(kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">/* return benignly */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="afa0aab17f062b64973ef26554d46c306"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa0aab17f062b64973ef26554d46c306">&#9670;&nbsp;</a></span>initiate_privacyamplification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int initiate_privacyamplification </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structkeyblock.html">keyblock</a> *&#160;</td>
          <td class="paramname"><em>kb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="priv__amp_8h.html">priv_amp.h</a> <br  />
 Part of the quantum key distribution software for error correction and privacy amplification. </p>
<p>Description see below.</p>
<p>Copyright (C) 2020 Matthew Lee, National University of Singapore <a href="#" onclick="location.href='mai'+'lto:'+'cra'+'zo'+'ter'+'@g'+'mai'+'l.'+'com'; return false;">crazo<span style="display: none;">.nosp@m.</span>ter@<span style="display: none;">.nosp@m.</span>gmail<span style="display: none;">.nosp@m.</span>.com</a> Copyright (C) 2005-2007 Christian Kurtsiefer, National University of Singapore <a href="#" onclick="location.href='mai'+'lto:'+'chr'+'is'+'tia'+'n.'+'kur'+'ts'+'ief'+'er'+'@gm'+'ai'+'l.c'+'om'; return false;">chris<span style="display: none;">.nosp@m.</span>tian<span style="display: none;">.nosp@m.</span>.kurt<span style="display: none;">.nosp@m.</span>sief<span style="display: none;">.nosp@m.</span>er@gm<span style="display: none;">.nosp@m.</span>ail.<span style="display: none;">.nosp@m.</span>com</a></p>
<p>This source code is free software; you can redistribute it and/or modify it under the terms of the GNU Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>
<p>This source code is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. Please refer to the GNU Public License for more details.</p>
<p>You should have received a copy of the GNU Public License along with this source code; if not, write to: Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</p>
<p>@license GPL-3.0+ <a href="http://spdx.org/licenses/GPL-3.0+">http://spdx.org/licenses/GPL-3.0+</a></p>
<hr  />
<p>This is a refactored version of Kurtsiefer's <a class="el" href="ecd2_8c.html">ecd2.c</a> to modularize parts of the code. This section modularizes the parts of the code that is predominantly used for privacy amplification. </p>

<p class="definition">Definition at line <a class="el" href="priv__amp_8c_source.html#l00011">11</a> of file <a class="el" href="priv__amp_8c_source.html">priv_amp.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                                                       {</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seed;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a> *h8; <span class="comment">/* head for trigger message */</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">/* generate local RNG seed */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">seed</a> = <a class="code" href="rnd_8c.html#ac9442118526276dea7a18026f1af5d33">get_r_seed</a>();</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment">/* prepare messagehead */</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  h8 = (<span class="keyword">struct </span><a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a> *)<a class="code" href="debug_8c.html#af8c2db3d81151416ecd3dcb6f38e3711">malloc2</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a>));</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordflow">if</span> (!h8) <span class="keywordflow">return</span> 62; <span class="comment">/* can&#39;t malloc */</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#ae925f617d0b0cdb79b3aa1da98da4821">tag</a> = <a class="code" href="packets_8h.html#ac4fe1c43e02ab8663f6cd57dfd5c62fb">ERRC_PROTO_tag</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a6d681ea4cb2a822364ccbc3a04166a6f">bytelength</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a>);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#ad666a7bae81e449585885b54d906cba9">subtype</a> = <a class="code" href="packets_8h.html#a54b7e55e92b8a00f48a61bf5f4df081f">ERRC_ERRDET_8_subtype</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a86892c486f9556bee7a19be8a3ac1ead">epoch</a> = kb-&gt;<a class="code" href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">startepoch</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#af81d04f842f55425b28aaff4385bd3b8">number_of_epochs</a> = kb-&gt;<a class="code" href="structkeyblock.html#a39ef5181e0b5a80b4487af22f3fc0424">numberofepochs</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">seed</a> = <a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">seed</a>;                <span class="comment">/* significant content */</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a7d3544a55477fc9814b3276efd48cbe2">lostbits</a> = kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a>; <span class="comment">/* this is what we use for PA */</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  h8-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#af3d8715d27083d703a50e5b78faf63b7">correctedbits</a> = kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">/* insert message in msg pool */</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <a class="code" href="comms_8c.html#ab685a2df59da9e7fb20e4fd477eca731">insert_sendpacket</a>((<span class="keywordtype">char</span> *)h8, h8-&gt;bytelength);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="comment">/* do actual privacy amplification */</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="priv__amp_8c.html#ad859394d26f4d4609bee37a5a18cb135">do_privacy_amplification</a>(kb, <a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">seed</a>, kb-&gt;<a class="code" href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">leakagebits</a>);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af014f9642f652afb57efba0d1eddd37b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af014f9642f652afb57efba0d1eddd37b">&#9670;&nbsp;</a></span>receive_privamp_msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int receive_privamp_msg </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>receivebuf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="priv__amp_8c_source.html#l00039">39</a> of file <a class="el" href="priv__amp_8c_source.html">priv_amp.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                          {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keyword">struct </span><a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a> *in_head; <span class="comment">/* holds header */</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keyword">struct </span><a class="code" href="structkeyblock.html">keyblock</a> *kb;           <span class="comment">/* poits to thread info */</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">/* get pointers for header...*/</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  in_head = (<span class="keyword">struct </span><a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a> *)receivebuf;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="comment">/* ...and find thread: */</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  kb = <a class="code" href="thread__mgmt_8c.html#ae770bdf990c6463259dc2388ecb81666">get_thread</a>(in_head-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a86892c486f9556bee7a19be8a3ac1ead">epoch</a>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">if</span> (!kb) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    fprintf(stderr, <span class="stringliteral">&quot;epoch %08x: &quot;</span>, in_head-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a86892c486f9556bee7a19be8a3ac1ead">epoch</a>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">return</span> 49;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">/* retreive number of corrected bits */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  kb-&gt;<a class="code" href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">correctederrors</a> = in_head-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#af3d8715d27083d703a50e5b78faf63b7">correctedbits</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">/* do some consistency checks???*/</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">/* pass to the core prog */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="priv__amp_8c.html#ad859394d26f4d4609bee37a5a18cb135">do_privacy_amplification</a>(kb, in_head-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">seed</a>, in_head-&gt;<a class="code" href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a7d3544a55477fc9814b3276efd48cbe2">lostbits</a>);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="astructkeyblock_html_ae560de6da346dbdc80cdf148232db1a5"><div class="ttname"><a href="structkeyblock.html#ae560de6da346dbdc80cdf148232db1a5">keyblock::correctederrors</a></div><div class="ttdeci">int correctederrors</div><div class="ttdoc">number of corrected bits</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00066">keyblock.h:66</a></div></div>
<div class="ttc" id="adefaultdefinitions_8h_html_ade60ede0376eec193b38f3f28cb62c5e"><div class="ttname"><a href="defaultdefinitions_8h.html#ade60ede0376eec193b38f3f28cb62c5e">FNAMELENGTH</a></div><div class="ttdeci">#define FNAMELENGTH</div><div class="ttdoc">defaultdefinitions.h   Definition file for default variables in ecd2</div><div class="ttdef"><b>Definition:</b> <a href="defaultdefinitions_8h_source.html#l00034">defaultdefinitions.h:33</a></div></div>
<div class="ttc" id="aecd2_8h_html_a9609eae2e0e4f132f31d442a8d3acc7f"><div class="ttname"><a href="ecd2_8h.html#a9609eae2e0e4f132f31d442a8d3acc7f">errormargin</a></div><div class="ttdeci">float errormargin</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00217">ecd2.h:217</a></div></div>
<div class="ttc" id="adebug_8c_html_ae9cba13dc8aa5d62e13112d01be090ba"><div class="ttname"><a href="debug_8c.html#ae9cba13dc8aa5d62e13112d01be090ba">free2</a></div><div class="ttdeci">void free2(void *p)</div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00019">debug.c:19</a></div></div>
<div class="ttc" id="astructheader__7_html"><div class="ttname"><a href="structheader__7.html">header_7</a></div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00007">pkt_header_7.h:7</a></div></div>
<div class="ttc" id="astructheader__7_html_aca413382a94bc8f2f6cca2841b4c4ea2"><div class="ttname"><a href="structheader__7.html#aca413382a94bc8f2f6cca2841b4c4ea2">header_7::numberofbits</a></div><div class="ttdeci">int numberofbits</div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00011">pkt_header_7.h:11</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_a7d3544a55477fc9814b3276efd48cbe2"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a7d3544a55477fc9814b3276efd48cbe2">ERRC_ERRDET_8::lostbits</a></div><div class="ttdeci">unsigned int lostbits</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00160">packets.h:160</a></div></div>
<div class="ttc" id="astructkeyblock_html_a080e68be385bfa19ea1c1745c84d0716"><div class="ttname"><a href="structkeyblock.html#a080e68be385bfa19ea1c1745c84d0716">keyblock::finalkeybits</a></div><div class="ttdeci">int finalkeybits</div><div class="ttdoc">how much is left</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00067">keyblock.h:67</a></div></div>
<div class="ttc" id="astructkeyblock_html_a7cc8739f33c53ca94123d468a1c090a4"><div class="ttname"><a href="structkeyblock.html#a7cc8739f33c53ca94123d468a1c090a4">keyblock::initialbits</a></div><div class="ttdeci">int initialbits</div><div class="ttdoc">bits to start with</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00043">keyblock.h:43</a></div></div>
<div class="ttc" id="astructkeyblock_html_af477132d975581ce79cab80a4fdfafd1"><div class="ttname"><a href="structkeyblock.html#af477132d975581ce79cab80a4fdfafd1">keyblock::startepoch</a></div><div class="ttdeci">unsigned int startepoch</div><div class="ttdoc">initial epoch of block</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00034">keyblock.h:34</a></div></div>
<div class="ttc" id="acomms_8c_html_ab685a2df59da9e7fb20e4fd477eca731"><div class="ttname"><a href="comms_8c.html#ab685a2df59da9e7fb20e4fd477eca731">insert_sendpacket</a></div><div class="ttdeci">int insert_sendpacket(char *message, int length)</div><div class="ttdoc">comms.h   Part of the quantum key distribution software for error correction and privacy amplificatio...</div><div class="ttdef"><b>Definition:</b> <a href="comms_8c_source.html#l00014">comms.c:14</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html">ERRC_ERRDET_8</a></div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00153">packets.h:153</a></div></div>
<div class="ttc" id="astructkeyblock_html"><div class="ttname"><a href="structkeyblock.html">keyblock</a></div><div class="ttdoc">Definition of a structure containing all informations about a block.</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00033">keyblock.h:33</a></div></div>
<div class="ttc" id="arnd_8c_html_a099de46fae1a39893ab79719bf42f2c2"><div class="ttname"><a href="rnd_8c.html#a099de46fae1a39893ab79719bf42f2c2">PRNG_value2_32</a></div><div class="ttdeci">unsigned int PRNG_value2_32(unsigned int *state)</div><div class="ttdef"><b>Definition:</b> <a href="rnd_8c_source.html#l00085">rnd.c:85</a></div></div>
<div class="ttc" id="astructkeyblock_html_a19b74f671254c24bedb3b167c2b73621"><div class="ttname"><a href="structkeyblock.html#a19b74f671254c24bedb3b167c2b73621">keyblock::mainbuf</a></div><div class="ttdeci">unsigned int * mainbuf</div><div class="ttdoc">points to main buffer for key</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00037">keyblock.h:37</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_a86892c486f9556bee7a19be8a3ac1ead"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a86892c486f9556bee7a19be8a3ac1ead">ERRC_ERRDET_8::epoch</a></div><div class="ttdeci">unsigned int epoch</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00157">packets.h:157</a></div></div>
<div class="ttc" id="apackets_8h_html_ac4fe1c43e02ab8663f6cd57dfd5c62fb"><div class="ttname"><a href="packets_8h.html#ac4fe1c43e02ab8663f6cd57dfd5c62fb">ERRC_PROTO_tag</a></div><div class="ttdeci">#define ERRC_PROTO_tag</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00044">packets.h:43</a></div></div>
<div class="ttc" id="astructheader__7_html_aab7a9200bfffed9a73f057aa631b5b7f"><div class="ttname"><a href="structheader__7.html#aab7a9200bfffed9a73f057aa631b5b7f">header_7::epoc</a></div><div class="ttdeci">unsigned int epoc</div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00009">pkt_header_7.h:9</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59"><div class="ttname"><a href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea7a2d9b621d426a7b283d249f78abea59">handleId_finalKeyDir</a></div><div class="ttdeci">@ handleId_finalKeyDir</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8h_source.html#l00055">helpers.h:55</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c"><div class="ttname"><a href="helpers_8h.html#a60dccdec5aced9500d5f728bce5b9b3ea61d4048a034b1debc9e694bcbb6ef95c">handleId_notifyPipe</a></div><div class="ttdeci">@ handleId_notifyPipe</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8h_source.html#l00056">helpers.h:56</a></div></div>
<div class="ttc" id="athread__mgmt_8c_html_ae770bdf990c6463259dc2388ecb81666"><div class="ttname"><a href="thread__mgmt_8c.html#ae770bdf990c6463259dc2388ecb81666">get_thread</a></div><div class="ttdeci">struct keyblock * get_thread(unsigned int epoch)</div><div class="ttdef"><b>Definition:</b> <a href="thread__mgmt_8c_source.html#l00154">thread_mgmt.c:154</a></div></div>
<div class="ttc" id="arnd_8c_html_abcc0dd5e29de4965c7b9816465f933b7"><div class="ttname"><a href="rnd_8c.html#abcc0dd5e29de4965c7b9816465f933b7">parity</a></div><div class="ttdeci">int parity(unsigned int a)</div><div class="ttdef"><b>Definition:</b> <a href="rnd_8c_source.html#l00037">rnd.c:37</a></div></div>
<div class="ttc" id="aecd2_8h_html_a2ae62e6ac7053435d99859ae80a3b48f"><div class="ttname"><a href="ecd2_8h.html#a2ae62e6ac7053435d99859ae80a3b48f">fhandle</a></div><div class="ttdeci">FILE * fhandle[8]</div><div class="ttdoc">handles for files accessed by buffered I/O</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00213">ecd2.h:213</a></div></div>
<div class="ttc" id="ahelpers_8c_html_a6191b118553d1fbe518e4cb9dc10c3cd"><div class="ttname"><a href="helpers_8c.html#a6191b118553d1fbe518e4cb9dc10c3cd">binentrop</a></div><div class="ttdeci">float binentrop(float q)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00043">helpers.c:43</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_a464345774f6f474a182c9c83500c5c08"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a464345774f6f474a182c9c83500c5c08">ERRC_ERRDET_8::seed</a></div><div class="ttdeci">unsigned int seed</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00159">packets.h:159</a></div></div>
<div class="ttc" id="apriv__amp_8c_html_ad859394d26f4d4609bee37a5a18cb135"><div class="ttname"><a href="priv__amp_8c.html#ad859394d26f4d4609bee37a5a18cb135">do_privacy_amplification</a></div><div class="ttdeci">int do_privacy_amplification(struct keyblock *kb, unsigned int seed, int lostbits)</div><div class="ttdef"><b>Definition:</b> <a href="priv__amp_8c_source.html#l00065">priv_amp.c:65</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_a6d681ea4cb2a822364ccbc3a04166a6f"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#a6d681ea4cb2a822364ccbc3a04166a6f">ERRC_ERRDET_8::bytelength</a></div><div class="ttdeci">unsigned int bytelength</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00155">packets.h:155</a></div></div>
<div class="ttc" id="adebug_8c_html_af8c2db3d81151416ecd3dcb6f38e3711"><div class="ttname"><a href="debug_8c.html#af8c2db3d81151416ecd3dcb6f38e3711">malloc2</a></div><div class="ttdeci">char * malloc2(unsigned int s)</div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00007">debug.c:7</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_ae925f617d0b0cdb79b3aa1da98da4821"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#ae925f617d0b0cdb79b3aa1da98da4821">ERRC_ERRDET_8::tag</a></div><div class="ttdeci">unsigned int tag</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00154">packets.h:154</a></div></div>
<div class="ttc" id="athread__mgmt_8c_html_a50f74be3f39663e19901c3e1ed240698"><div class="ttname"><a href="thread__mgmt_8c.html#a50f74be3f39663e19901c3e1ed240698">remove_thread</a></div><div class="ttdeci">int remove_thread(unsigned int epoch)</div><div class="ttdef"><b>Definition:</b> <a href="thread__mgmt_8c_source.html#l00166">thread_mgmt.c:166</a></div></div>
<div class="ttc" id="apackets_8h_html_a54b7e55e92b8a00f48a61bf5f4df081f"><div class="ttname"><a href="packets_8h.html#a54b7e55e92b8a00f48a61bf5f4df081f">ERRC_ERRDET_8_subtype</a></div><div class="ttdeci">#define ERRC_ERRDET_8_subtype</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00164">packets.h:163</a></div></div>
<div class="ttc" id="astructkeyblock_html_a39ef5181e0b5a80b4487af22f3fc0424"><div class="ttname"><a href="structkeyblock.html#a39ef5181e0b5a80b4487af22f3fc0424">keyblock::numberofepochs</a></div><div class="ttdeci">unsigned int numberofepochs</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00035">keyblock.h:35</a></div></div>
<div class="ttc" id="ahelpers_8h_html_ae447cbbcd1ebc2fb52c0ef6c0672cffc"><div class="ttname"><a href="helpers_8h.html#ae447cbbcd1ebc2fb52c0ef6c0672cffc">bt_mask</a></div><div class="ttdeci">__inline__ unsigned int bt_mask(int i)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8h_source.html#l00066">helpers.h:66</a></div></div>
<div class="ttc" id="aecd2_8h_html_ad7c92fd80ab487ec49cee4f015f112ec"><div class="ttname"><a href="ecd2_8h.html#ad7c92fd80ab487ec49cee4f015f112ec">handle</a></div><div class="ttdeci">int handle[8]</div><div class="ttdoc">handles for files accessed by raw I/O</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00212">ecd2.h:212</a></div></div>
<div class="ttc" id="astructheader__7_html_ad10670821f2dc976f91dc2daa7bac0c2"><div class="ttname"><a href="structheader__7.html#ad10670821f2dc976f91dc2daa7bac0c2">header_7::numberofepochs</a></div><div class="ttdeci">unsigned int numberofepochs</div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00010">pkt_header_7.h:10</a></div></div>
<div class="ttc" id="arnd_8c_html_ac9442118526276dea7a18026f1af5d33"><div class="ttname"><a href="rnd_8c.html#ac9442118526276dea7a18026f1af5d33">get_r_seed</a></div><div class="ttdeci">unsigned int get_r_seed(void)</div><div class="ttdef"><b>Definition:</b> <a href="rnd_8c_source.html#l00101">rnd.c:101</a></div></div>
<div class="ttc" id="astructkeyblock_html_acb4d8d5a8ec6dfeaad5352daf4d8b843"><div class="ttname"><a href="structkeyblock.html#acb4d8d5a8ec6dfeaad5352daf4d8b843">keyblock::RNG_state</a></div><div class="ttdeci">unsigned int RNG_state</div><div class="ttdoc">keeps the state of the PRNG for this thread</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00052">keyblock.h:52</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_af3d8715d27083d703a50e5b78faf63b7"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#af3d8715d27083d703a50e5b78faf63b7">ERRC_ERRDET_8::correctedbits</a></div><div class="ttdeci">unsigned int correctedbits</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00161">packets.h:161</a></div></div>
<div class="ttc" id="astructkeyblock_html_a50aa283cdce616652b5d3a8b91293fce"><div class="ttname"><a href="structkeyblock.html#a50aa283cdce616652b5d3a8b91293fce">keyblock::BellValue</a></div><div class="ttdeci">float BellValue</div><div class="ttdoc">for Ekert-type protocols</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00068">keyblock.h:68</a></div></div>
<div class="ttc" id="aecd2_8h_html_a46fec7a15e43bfc6c030840db0536485"><div class="ttname"><a href="ecd2_8h.html#a46fec7a15e43bfc6c030840db0536485">fname</a></div><div class="ttdeci">char fname[8][FNAMELENGTH]</div><div class="ttdoc">filenames</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00211">ecd2.h:211</a></div></div>
<div class="ttc" id="acostream_8c_html_a5e4d5eded57665a7c40e22af8ff60b9a"><div class="ttname"><a href="costream_8c.html#a5e4d5eded57665a7c40e22af8ff60b9a">ffnam</a></div><div class="ttdeci">char ffnam[FNAMELENGTH+10]</div><div class="ttdef"><b>Definition:</b> <a href="costream_8c_source.html#l00702">costream.c:702</a></div></div>
<div class="ttc" id="aecd2_8h_html_a3dcabd5a7b4998184c8e155bfefc35df"><div class="ttname"><a href="ecd2_8h.html#a3dcabd5a7b4998184c8e155bfefc35df">disable_privacyamplification</a></div><div class="ttdeci">int disable_privacyamplification</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00216">ecd2.h:216</a></div></div>
<div class="ttc" id="astructkeyblock_html_a6fbe46cd00a669058100f9a0b70a34f3"><div class="ttname"><a href="structkeyblock.html#a6fbe46cd00a669058100f9a0b70a34f3">keyblock::leakagebits</a></div><div class="ttdeci">int leakagebits</div><div class="ttdoc">information which has gone public</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00044">keyblock.h:44</a></div></div>
<div class="ttc" id="aecd2_8h_html_a1cf2a769e7368499d8872067d8ceacfd"><div class="ttname"><a href="ecd2_8h.html#a1cf2a769e7368499d8872067d8ceacfd">bellmode</a></div><div class="ttdeci">int bellmode</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00215">ecd2.h:215</a></div></div>
<div class="ttc" id="adefaultdefinitions_8h_html_a2c11ab874c0a909ae05d17b0f21d9ac8"><div class="ttname"><a href="defaultdefinitions_8h.html#a2c11ab874c0a909ae05d17b0f21d9ac8">OUTPERMISSIONS</a></div><div class="ttdeci">#define OUTPERMISSIONS</div><div class="ttdef"><b>Definition:</b> <a href="defaultdefinitions_8h_source.html#l00054">defaultdefinitions.h:53</a></div></div>
<div class="ttc" id="astructkeyblock_html_ab8134707bcc838e29a0f412464b32542"><div class="ttname"><a href="structkeyblock.html#ab8134707bcc838e29a0f412464b32542">keyblock::workbits</a></div><div class="ttdeci">int workbits</div><div class="ttdoc">bits to work with for BICONF/parity check</div><div class="ttdef"><b>Definition:</b> <a href="keyblock_8h_source.html#l00054">keyblock.h:54</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_ad666a7bae81e449585885b54d906cba9"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#ad666a7bae81e449585885b54d906cba9">ERRC_ERRDET_8::subtype</a></div><div class="ttdeci">unsigned int subtype</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00156">packets.h:156</a></div></div>
<div class="ttc" id="aecd2_8h_html_a9705b16acc86a3fcb33a75cd1eb0c43c"><div class="ttname"><a href="ecd2_8h.html#a9705b16acc86a3fcb33a75cd1eb0c43c">intrinsicerr</a></div><div class="ttdeci">float intrinsicerr</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00218">ecd2.h:218</a></div></div>
<div class="ttc" id="apkt__header__7_8h_html_a14ea2cca450c06c029139e6f8a77524f"><div class="ttname"><a href="pkt__header__7_8h.html#a14ea2cca450c06c029139e6f8a77524f">TYPE_7_TAG</a></div><div class="ttdeci">#define TYPE_7_TAG</div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00005">pkt_header_7.h:4</a></div></div>
<div class="ttc" id="adefaultdefinitions_8h_html_abb441a467a8a3c646cca05908e82fd7b"><div class="ttname"><a href="defaultdefinitions_8h.html#abb441a467a8a3c646cca05908e82fd7b">FILEOUTMODE</a></div><div class="ttdeci">#define FILEOUTMODE</div><div class="ttdef"><b>Definition:</b> <a href="defaultdefinitions_8h_source.html#l00053">defaultdefinitions.h:52</a></div></div>
<div class="ttc" id="astructheader__7_html_a08ea28e2fbeb87380a81fcb3c1bef8f0"><div class="ttname"><a href="structheader__7.html#a08ea28e2fbeb87380a81fcb3c1bef8f0">header_7::tag</a></div><div class="ttdeci">int tag</div><div class="ttdef"><b>Definition:</b> <a href="pkt__header__7_8h_source.html#l00008">pkt_header_7.h:8</a></div></div>
<div class="ttc" id="astruct_e_r_r_c___e_r_r_d_e_t__8_html_af81d04f842f55425b28aaff4385bd3b8"><div class="ttname"><a href="struct_e_r_r_c___e_r_r_d_e_t__8.html#af81d04f842f55425b28aaff4385bd3b8">ERRC_ERRDET_8::number_of_epochs</a></div><div class="ttdeci">unsigned int number_of_epochs</div><div class="ttdef"><b>Definition:</b> <a href="packets_8h_source.html#l00158">packets.h:158</a></div></div>
<div class="ttc" id="aecd2_8h_html_a1f893df415a3af2c9b549367a95b99b2"><div class="ttname"><a href="ecd2_8h.html#a1f893df415a3af2c9b549367a95b99b2">verbosity_level</a></div><div class="ttdeci">int verbosity_level</div><div class="ttdef"><b>Definition:</b> <a href="ecd2_8h_source.html#l00219">ecd2.h:219</a></div></div>
<div class="ttc" id="ahelpers_8c_html_a9e1a87974d8c015ddb41f248076f09e0"><div class="ttname"><a href="helpers_8c.html#a9e1a87974d8c015ddb41f248076f09e0">atohex</a></div><div class="ttdeci">void atohex(char *target, unsigned int v)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00032">helpers.c:32</a></div></div>
<div class="ttc" id="atransferd_8h_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="transferd_8h.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="transferd_8h_source.html#l00321">transferd.h:321</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_69202652be06fd0e05a491cdb470f56e.html">errorcorrection</a></li><li class="navelem"><a class="el" href="priv__amp_8c.html">priv_amp.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.19 </li>
  </ul>
</div>
</body>
</html>
